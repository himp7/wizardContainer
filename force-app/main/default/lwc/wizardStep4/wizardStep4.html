<template>
    <lightning-card title="Review & Confirm" icon-name="standard:approval">
        <div class="slds-p-around_medium">

            <!-- Instructions -->
            <div class="slds-m-bottom_large">
                <p class="slds-text-body_small slds-text-color_weak">
                    Please review the rule details below before creating.
                </p>
            </div>

            <!-- Summary Sections -->
            <div class="summary-container">

                <!-- Section 1: Rule Details -->
                <div class="summary-section slds-m-bottom_large">
                    <div class="section-header slds-m-bottom_small">
                        <lightning-icon 
                            icon-name="standard:document" 
                            size="small" 
                            class="slds-m-right_x-small">
                        </lightning-icon>
                        <h3 class="slds-text-heading_small">Rule Details</h3>
                    </div>
                    <div class="section-content">
                        <dl class="slds-list_horizontal slds-wrap">
                            <dt class="slds-item_label slds-text-color_weak slds-truncate" title="Rule Name">
                                Rule Name:
                            </dt>
                            <dd class="slds-item_detail slds-truncate" title={ruleData.ruleName}>
                                {ruleData.ruleName}
                            </dd>
                            
                            <dt class="slds-item_label slds-text-color_weak slds-truncate" title="Description">
                                Description:
                            </dt>
                            <dd class="slds-item_detail" title={ruleData.description}>
                                <template if:true={ruleData.description}>
                                    {ruleData.description}
                                </template>
                                <template if:false={ruleData.description}>
                                    <span class="slds-text-color_weak">â€”</span>
                                </template>
                            </dd>
                            
                            <!-- NEW: Is Active Display -->
                            <dt class="slds-item_label slds-text-color_weak slds-truncate" title="Status">
                                Status:
                            </dt>
                            <dd class="slds-item_detail slds-truncate">
                                <template if:true={ruleData.isActive}>
                                    <span class="slds-badge slds-theme_success">
                                        <lightning-icon icon-name="utility:check" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                                        Active
                                    </span>
                                </template>
                                <template if:false={ruleData.isActive}>
                                    <span class="slds-badge">
                                        <lightning-icon icon-name="utility:ban" size="xx-small" class="slds-m-right_xx-small"></lightning-icon>
                                        Inactive
                                    </span>
                                </template>
                            </dd>
                        </dl>
                    </div>
                </div>

                <!-- Section 2: Trigger Selection -->
                <div class="summary-section slds-m-bottom_large">
                    <div class="section-header slds-m-bottom_small">
                        <lightning-icon 
                            icon-name="standard:filter" 
                            size="small" 
                            class="slds-m-right_x-small">
                        </lightning-icon>
                        <h3 class="slds-text-heading_small">Trigger Selection</h3>
                    </div>
                    <div class="section-content">
                        <template if:true={hasTriggerData}>
                            <template for:each={triggerSummary} for:item="trigger">
                                <div key={trigger.category} class="trigger-group slds-m-bottom_medium">
                                    <div class="slds-text-title slds-m-bottom_x-small">
                                        {trigger.categoryLabel}
                                    </div>
                                    <div class="slds-pill_container">
                                        <template for:each={trigger.options} for:item="option">
                                            <span key={option} class="slds-pill slds-pill_link">
                                                <span class="slds-pill__label">{option}</span>
                                            </span>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </template>
                    </div>
                </div>

             <!-- In Section 3: Case Creation Details -->
<dt class="slds-item_label slds-text-color_weak slds-truncate" title="Case Type">
    Case Type:
</dt>
<dd class="slds-item_detail slds-truncate" title={ruleData.caseType}>
    {ruleData.caseType}
</dd>

<!-- NEW: Priority -->
<dt class="slds-item_label slds-text-color_weak slds-truncate" title="Priority">
    Priority:
</dt>
<dd class="slds-item_detail slds-truncate" title={ruleData.priority}>
    <span class={priorityBadgeClass}>
        {ruleData.priority}
    </span>
</dd>

<dt class="slds-item_label slds-text-color_weak slds-truncate" title="Days Before">
    Days Before:
</dt>
<dd class="slds-item_detail slds-truncate" title={ruleData.daysBefore}>
    {ruleData.daysBefore}
</dd>

            </div>

            <!-- Loading Spinner -->
            <template if:true={isLoading}>
                <div class="slds-m-top_large">
                    <lightning-spinner 
                        alternative-text="Creating rule..." 
                        size="medium">
                    </lightning-spinner>
                </div>
            </template>

            <!-- Error Message -->
            <template if:true={errorMessage}>
                <div class="slds-m-top_medium">
                    <div class="slds-notify slds-notify_alert slds-alert_error" role="alert">
                        <span class="slds-assistive-text">error</span>
                        <h2>{errorMessage}</h2>
                    </div>
                </div>
            </template>

        </div>

        <!-- Footer Buttons -->
        <div slot="footer" class="slds-clearfix">
            <div class="slds-float_right">
                <lightning-button
                    label="Back"
                    onclick={handleBack}
                    disabled={isLoading}
                    class="slds-m-right_small">
                </lightning-button>
                <lightning-button
                    variant="brand"
                    label="Create Rule"
                    onclick={handleCreate}
                    disabled={isLoading}
                    icon-name="utility:check">
                </lightning-button>
            </div>
        </div>

    </lightning-card>
</template>